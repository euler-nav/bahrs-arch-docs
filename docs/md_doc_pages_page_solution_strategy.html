<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AMS Advanced Air Mobility Sensors UG: Solution strategy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="../../../99_3rd_party/mathjax/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">AMS Advanced Air Mobility Sensors UG
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_pages_page_solution_strategy.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Solution strategy </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="page_solution_strategy"></a> </p>
<h1><a class="anchor" id="sec_solution_strategy_general"></a>
General</h1>
<h2><a class="anchor" id="subsec_solution_strategy_operating_system"></a>
Operating system</h2>
<p>The FreeRTOS operating system with CMSIS API is used.</p>
<p><b>Rationale 1</b>: we need multiple tasks that are executed at different frequencies.</p>
<p><b>Rationale 2</b>: we use FreeRTOS because</p>
<ol type="1">
<li>It is free, open source, and extremely lightweigh</li>
<li>STM32CubeIDE has a built-in support for FreeRTOS configuration</li>
</ol>
<p><b>Rationale 3</b>: we use CMSIS API v2 because</p>
<ol type="1">
<li>STM32CubeIDE relies on it</li>
<li>The API offers an option to switch to a different RTOS in future, for example to some safe RTOS</li>
</ol>
<h2><a class="anchor" id="subsec_solution_strategy_programming_language"></a>
Programming language</h2>
<p>The software is written in C and C++. The languages can be mixed.</p>
<p><b>Rationale</b>: C++ features are handy for implementation of sensor fusion algorithms, at the same time HAL libraries and FreeRTOS source files are in C.</p>
<h2><a class="anchor" id="subsec_solution_strategy_source_file_types"></a>
Source code classification</h2>
<p>All the source code files shall fall into one of the following categories:</p>
<ol type="1">
<li>Software components</li>
<li>Operating system</li>
<li>Libraries</li>
</ol>
<h3><a class="anchor" id="subsubsec_solution_strategy_software_component"></a>
Software components</h3>
<p>A software component is a class that realizes one or more primary or auxiliary system functions mapped to the software. A wrapper that inplements a C-API of a software component belongs to the software component.</p>
<h3><a class="anchor" id="subsubsec_solution_strategy_operating_system"></a>
Operating system</h3>
<p>All the operating system source files including API wrappers belong to the operating system.</p>
<h3><a class="anchor" id="subsubsec_solution_strategy_libraries"></a>
Libraries</h3>
<p>Everything that is neither a software component nor a piece of an operating system. Examples: linear algebra library, runtime environment (RTE) implementation, STM32 HAL libraries.</p>
<h2><a class="anchor" id="subsubsec_solution_strategy_dynamic_memory"></a>
Usage of dynamic memory</h2>
<p>Dynamic memory shall not be used. Consequently, functions, templates, and objects from the standard C++ library that rely on dynamic memory shall not be used.</p>
<p><b>Exceptions</b>:</p><ol type="1">
<li>Functionality used for development purpose only</li>
<li>Operating system</li>
</ol>
<h1><a class="anchor" id="sec_solution_strategy_patterns_and_principles"></a>
Patterns and principles</h1>
<h2><a class="anchor" id="subsec_solution_strategy_software_components"></a>
Software components</h2>
<h3><a class="anchor" id="subsubsec_solution_strategy_swc_principles"></a>
Principles</h3>
<ol type="1">
<li>SWCs shall exchange data by means of software component ports provided by RTE</li>
<li>SWCs are split into two categories: basic software components and application software components.</li>
<li>Application software components shall not access functions from HAL libraries.</li>
<li>Application software components shall not access OS APIs.</li>
<li>A software component shall be implemented as a class.</li>
<li>SWC instances shall be allocated on static memory during system initialization.</li>
<li>SWCs shall not be created dynamically.</li>
<li>SWCs shall not be copied of moved.</li>
<li>One class can implement multiple similar SWCs. Example: a driver of a sensor that is present twice in the system.</li>
<li>The following APIs are mandatory for all software components<ul>
<li>Initialization</li>
<li>Initialization status accessor</li>
<li>Instance getter</li>
</ul>
</li>
<li>Every SWC class shall provide a number of available SWC instances</li>
</ol>
<h3><a class="anchor" id="subsubsec_solution_strategy_swc_patterns"></a>
Design patterns</h3>
<ol type="1">
<li>All software components shall inherit from the interface class template <a class="el" href="class_c_software_component.html">CSoftwareComponent</a> following the Curiously Recurring Template Pattern (CRTP).</li>
<li>The base class <a class="el" href="class_c_software_component.html">CSoftwareComponent</a> shall delete copy and move constructors and assignment operators</li>
<li>A constructor and destructor of the base class <a class="el" href="class_c_software_component.html">CSoftwareComponent</a> shall be private</li>
<li>SWC instances shall be declared as static local variables in the implementation of the static API <a class="el" href="class_c_software_component.html#abdd9db8140668e4b42e7946248d63126">CSoftwareComponent::GetInstance</a>.</li>
</ol>
<p><b>Remark</b>: the aforementioned design patterns shall help to fulfill the software component design principles listed in the previous section.</p>
<p><b>Example of a SWC declaration</b>: <a class="el" href="class_c_software_component_example.html">CSoftwareComponentExample</a>.</p>
<h2><a class="anchor" id="subsec_solution_strategy_runtime_environment"></a>
Runtime environment (RTE)</h2>
<p>Runtime environment (RTE) is an object that aggregates all SWC ports.</p>
<h3><a class="anchor" id="subsubsec_solution_strategy_rte_principles"></a>
Principles and patterns</h3>
<ol type="1">
<li>RTE class shall be a singleton</li>
<li>SWC ports shall be accessible only by software components</li>
<li>SWC ports shall allow thread-safe data exchange between SWCs</li>
<li>SWC ports shall be read-write accessible</li>
</ol>
<h1><a class="anchor" id="sec_solution_strategy_algorithms"></a>
Signal processing algorithms</h1>
<h2><a class="anchor" id="subsec_solution_strategy_attitude_and_vertical_motion_estimation"></a>
Estimation of attitude and vertical motion</h2>
<h3><a class="anchor" id="subsubsec_solution_strategy_estimation_intro"></a>
Introduction</h3>
<p>Attitude and vertical motion (including altitude and vertical velocity) are estimated using data from a 6D IMU and a barometer. A <b>Kalman filter</b> is employed to fuse the signals from both sensors. This approach represents the current state-of-the-art and offers several key advantages:</p>
<ol type="1">
<li>Smoothing of measurement noise from the original sensor data.</li>
<li>The ability to extrapolate vertical velocity, altitude, and attitude between lower-frequency barometer readings.</li>
<li>Built-in accuracy assessment through the use of a state covariance matrix.</li>
<li>The capability to estimate inertial sensor errors and mitigate error growth during dead-reckoning.</li>
</ol>
<p>The estimator is implement in the form of a <b>closed-loop error state Kalman filter</b>. In this formulation, a linear Kalman filter is used to estimate the error in the state accumulated during the nonlinear state prediction process. This estimated state error is then applied to correct the predicted state, allowing the nonlinear prediction process to continue from the corrected value.</p>
<h3><a class="anchor" id="subsubsec_solution_strategy_estimation_state_vector"></a>
State vector</h3>
<p>The state vector has dimension 12 and includes</p>
<ol type="1">
<li>A quaternion \( \breve{\mathbf{q}}_{ns} \) defining a rotation from the IMU sensor frame to the local levelled coordinate frame</li>
<li>Barometric altitude \( h \) and velocity in downwards direction \( v_d \)</li>
<li>A vector of accelerometer biases \( \mathbf{b}_a \)</li>
<li>A vector of gyroscope biases \( \mathbf{b}_g \)</li>
</ol>
<h3><a class="anchor" id="subsubsec_solution_strategy_estimation_error_state_vector"></a>
State error vector</h3>
<p>The state error vector has dimension 10 and includes</p>
<ol type="1">
<li>Two attitude errors \( \psi_{n\tilde{n}_1} \) and \( \psi_{n\tilde{n}_2} \)</li>
<li>Vertical channel errors \( \delta h \) and \( \delta v_d \)</li>
<li>Error of the accelerometer bias estimate \( \delta\mathbf{b}_a \)</li>
<li>Error of the gyroscope bias estimate \( \delta\mathbf{b}_g \)</li>
</ol>
<h3><a class="anchor" id="subsubsec_solution_strategy_estimation_decisions"></a>
Technology decisions</h3>
<h4><a class="anchor" id="par_solution_strategy_technology_decision_1"></a>
Decoupling of magnetic heading estimation</h4>
<p>Magnetic heading is estimated separately from attitude and vertical motion.</p>
<p><b>Rationale:</b></p>
<p>Magnetometer signals are highly susceptible to environmental disturbances that vary significantly by location. These disturbances can degrade the performance and stability of a Kalman filter, reducing the accuracy and reliability of the estimated attitude and vertical motion parameters. Additionally, we have no control over where customers install EULER-NAV devices within the target vehicle, and they may choose a location prone to intense magnetic interference. Because our device cannot predict or compensate for these disturbances, incorporating magnetometer data into the core attitude and vertical motion estimates could lead to corrupted results, potentially giving customers a false impression of our product’s performance and quality.</p>
<h4><a class="anchor" id="par_solution_strategy_technology_decision_2"></a>
Single IMU signal source for every filter</h4>
<p><b>Rationale:</b></p>
<p>Allowing the Kalman filter to switch IMU input sources would necessitate re-initializing the estimation process for inertial sensor biases each time a switch occurs. Frequent re-initializations &ndash; such as those triggered by IMU monitor's false alarms &ndash; could degrade output accuracy, reduce filter stability, and endanger output integrity. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
    </li>
    <!-- Custom copyright notice -->
    <li class="footer">Copyright 2024 AMS Advanced Air Mobility Sensors UG. All rights reserved.</li>
  </ul>
</div>
</body>
</html>
